{
    "id": "rpt_sell_store",
    "name": "rpt_sell_store",
    "label": "零售店銷售紀錄",
    "meta": [
        {"id":"sid","label":"編號"},
        {"id":"purchaseDt","label":"銷售日期","eval":"$['purchaseDt']=$f.df('yyyy/MM/dd',$.purchaseDt)"},
        {"id":"barcode","label":"農藥條碼","eval":"$['barcode']='=\"'+$.barcode+' \"'"},
        {"id":"pesticideName","label":"普通名稱"},
        {"id":"formCode","label":"劑型"},
        {"id":"contents","label":"含量(%)"},
        {"id":"purchaseQty","label":"數量"},
        {"id":"cropName","label":"作物"},
        {"id":"pestName","label":"病蟲害"},
        {"id":"bId","label":"身分證字號"},
        {"id":"bName","label":"農友姓名"},
        {"id":"ds","label":"資料來源","eval":"$['ds'] = $.ds=='1' ? 'Excel' : $.ds=='2' ? 'WebService' :'POS' "},
        {"id":"e_sid","eval":"$['sid']=$.$i+1"}
    ],
    "query": {
        "$act": "rows",
        "$cmd": [
            " select  a.*, b.pesticideName , b.formCode , b.contents, ",
            " (select top 1 name from crop_t x where a.crop = code ) cropName, ",
            " (select top 1 name from pest_t x where a.diseases = code ) pestName ",
            " from psSaleSP a ",
            " left join barcode_view b on (a.barcode = b.barcode) ",
            " where baphiqId =  ",
            "  (select  top 1  'UP' + RIGHT('000000000000000000' + cast(dataId AS varchar(18)), 18) AS baphiqId from psretail ",
            "   where newId=${permit,string} or oldId=${permit,string})" ,
            " ${>=,purchaseDt,date,dp1}${<=,purchaseDt,date,dp2} ",
            " ${=,bId,string,bcid} ${=,bName,String,bcname}",
            " ${=,a.barcode,string,barcode} ${=,b.pesticideName,String,pesticideName}"
        ],
        "$orderby": "purchaseDt desc, barcode "
    },
    
    "export": {
        "$rem": "",
        "$act": "rows",
        "$ref_cmd": "query",
        "$ref_orderby": "query",
        "$before": "e_sid,barcode,ds,purchaseDt",
        "$fields": "sid,purchaseDt,barcode,pesticideName,formCode,contents,purchaseQty,cropName,pestName,bId,bName,ds"
    }
}
