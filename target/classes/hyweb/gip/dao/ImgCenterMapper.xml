<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="hyweb.gip.dao.ImgCenterMapper" >
  <resultMap id="BaseResultMap" type="hyweb.gip.pojo.mybatis.table.ImgCenter" >
    <id column="imgSeq" property="imgseq" jdbcType="INTEGER" />
    <result column="imgId" property="imgid" jdbcType="CHAR" />
    <result column="imgTitle" property="imgtitle" jdbcType="NVARCHAR" />
    <result column="imgContent" property="imgcontent" jdbcType="NVARCHAR" />
    <result column="imgStatus" property="imgstatus" jdbcType="NVARCHAR" />
    <result column="imgFileName" property="imgfilename" jdbcType="NVARCHAR" />
    <result column="imgFileUri" property="imgfileuri" jdbcType="NVARCHAR" />
    <result column="imgUploadUser" property="imguploaduser" jdbcType="NVARCHAR" />
    <result column="imgUploadTime" property="imguploadtime" jdbcType="TIMESTAMP" />
    <result column="imgUploadDept" property="imguploaddept" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    imgSeq, imgId, imgTitle, imgContent, imgStatus, imgFileName, imgFileUri, imgUploadUser, 
    imgUploadTime, imgUploadDept
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from ImgCenter
    where imgSeq = #{imgseq,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from ImgCenter
    where imgSeq = #{imgseq,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="hyweb.gip.pojo.mybatis.table.ImgCenter" 
  			useGeneratedKeys="true" keyProperty="imgseq">
    insert into ImgCenter ( imgTitle, 
      imgContent, imgStatus, imgFileName, 
      imgFileUri, imgUploadUser, imgUploadTime, imgUploadDept
      )
    values (#{imgtitle,jdbcType=NVARCHAR}, 
      #{imgcontent,jdbcType=NVARCHAR}, #{imgstatus,jdbcType=NVARCHAR}, #{imgfilename,jdbcType=NVARCHAR}, 
      #{imgfileuri,jdbcType=NVARCHAR}, #{imguploaduser,jdbcType=NVARCHAR}, #{imguploadtime,jdbcType=TIMESTAMP},
      #{imguploaddept,jdbcType=INTEGER})
  </insert>
  <update id="updateByPrimaryKey" parameterType="hyweb.gip.pojo.mybatis.table.ImgCenter" >
    update ImgCenter
    set 
      imgTitle = #{imgtitle,jdbcType=NVARCHAR},
      imgContent = #{imgcontent,jdbcType=NVARCHAR},
      imgStatus = #{imgstatus,jdbcType=NVARCHAR},
      imgFileName = #{imgfilename,jdbcType=NVARCHAR},
      imgFileUri = #{imgfileuri,jdbcType=NVARCHAR},
      imgUploadUser = #{imguploaduser,jdbcType=NVARCHAR},
      imgUploadTime = #{imguploadtime,jdbcType=TIMESTAMP},
      imgUploadDept = #{imguploaddept,jdbcType=INTEGER}
    where imgSeq = #{imgseq,jdbcType=INTEGER}
  </update>
    <select id="selectAll" resultMap="BaseResultMap" >
    select 
    <include refid="Base_Column_List" />
    from ImgCenter 
    order by imgUploadTime desc
  </select>
    <select id="selectByKey" resultMap="BaseResultMap" parameterType="java.lang.String">
    select 
    <include refid="Base_Column_List" />
    from ImgCenter 
    where imgTitle like #{key,jdbcType=NVARCHAR} or imgContent like #{key,jdbcType=NVARCHAR} 
    order by imgUploadTime desc
  </select>
    <select id="query" resultMap="BaseResultMap" parameterType="map">
  	select * from (
		select row_number() over (order by ${orderby}, imgId asc) as row_num, ${select} from ImgCenter a
		join dept b on a.imgUploadDept = b.deptseq 
		where ${where} AND ( b.deptHierarchyCode like ${depthierarchycode} or b.deptHierarchyCode = ${depthierarchycode1} )
	) as tb 
	where row_num between ((${page} - 1) * ${showNum} + 1) and (${page}*${showNum}) 
  </select>
      <select id="selectByDept" resultMap="BaseResultMap" parameterType="map">
    select 
    <include refid="Base_Column_List" />
    from ImgCenter a
    join dept b on a.imgUploadDept = b.deptseq 
    where b.deptHierarchyCode like ${depthierarchycode}  or b.deptHierarchyCode = ${depthierarchycode1}
    order by imgUploadTime desc
  </select>
  <select id="getByImgSeq"  resultType="java.lang.String" parameterType="int">
    select imgFileUri from ImgCenter where imgSeq=#{imgseq,jdbcType=INTEGER}
  </select>
  <select id="getByImgId" resultType="java.lang.String" parameterType="java.lang.String">
    select imgFileUri from ImgCenter where imgId=#{imgid,jdbcType=CHAR}
  </select>
  <select id="selectBySidAndImgId" resultMap="BaseResultMap">
  	select 
    <include refid="Base_Column_List" />
    from ImgCenter where imgId=#{imgId}
  </select>
  <select id="count" resultType="int" parameterType="map">
  	select count(*) 
    from ImgCenter a 
    join dept b on a.imgUploadDept = b.deptseq 
	where ${where} AND ( b.deptHierarchyCode like ${depthierarchycode} or b.deptHierarchyCode = ${depthierarchycode1})
  </select>
  <select id="getFileName" resultType="java.lang.String" parameterType="java.lang.String">
    select SUBSTRING(imgFileUri,(CHARINDEX('/',imgFileUri)+18),LEN(imgFileUri)) from ImgCenter where imgId=#{imgid,jdbcType=CHAR};
  </select>
</mapper>